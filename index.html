<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Road Object Detector</title>
<style>
body, html { margin:0; padding:0; overflow:hidden; background:white; font-family:sans-serif; }
#canvas { position:absolute; top:0; left:0; width:100%; height:100%; }
.ui-overlay {
  position:absolute; top:10px; left:10px; z-index:2;
  background:rgba(255,255,255,0.8); padding:10px; border-radius:10px;
  box-shadow:0 2px 10px rgba(0,0,0,0.3);
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div class="ui-overlay">
  <h3>3D Road Detector</h3>
  <p>Cars, animals, and objects detected on road.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Camera feed setup
const video = document.createElement('video');
video.autoplay = true;
video.muted = true;
video.playsInline = true;

navigator.mediaDevices.getUserMedia({ video: { facingMode:"environment" } })
  .then(stream => video.srcObject = stream);

// Load object detection model
let model;
cocoSsd.load().then(m => { model = m; detectFrame(); });

// Alarm
const beep = new Howl({ src:['https://actions.google.com/sounds/v1/alarms/beep_short.ogg'] });

// Draw fake 3D road
function drawRoad(){
  ctx.fillStyle = '#e0e0e0';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  
  // Green faded road path
  ctx.strokeStyle = 'rgba(0,200,0,0.3)';
  ctx.lineWidth = 50;
  ctx.beginPath();
  ctx.moveTo(canvas.width/2 - 50, canvas.height);
  ctx.lineTo(canvas.width/2 - 10, 0);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(canvas.width/2 + 50, canvas.height);
  ctx.lineTo(canvas.width/2 + 10, 0);
  ctx.stroke();
}

// Draw objects as icons on “road”
function drawObjects(predictions){
  predictions.forEach(pred => {
    let x = canvas.width/2 + (pred.bbox[0]-video.videoWidth/2)/2;
    let y = canvas.height - pred.bbox[1];

    // Choose icon based on object class
    if(pred.class==='car' || pred.class==='truck'){
      ctx.fillStyle = 'red';
      ctx.fillRect(x-15,y-15,30,30);
    } else if(pred.class==='dog' || pred.class==='cat' || pred.class==='person'){
      ctx.fillStyle = 'orange';
      ctx.beginPath();
      ctx.arc(x,y,15,0,Math.PI*2);
      ctx.fill();
    } else {
      ctx.fillStyle='blue';
      ctx.beginPath();
      ctx.arc(x,y,10,0,Math.PI*2);
      ctx.fill();
    }

    // Proximity alarm (approximate)
    if(pred.bbox[3] > 150) beep.play();
  });
}

// Main loop
function detectFrame(){
  if(!model) return requestAnimationFrame(detectFrame);
  model.detect(video).then(predictions => {
    drawRoad();
    drawObjects(predictions);
    requestAnimationFrame(detectFrame);
  });
}

</script>
</body>
</html>
